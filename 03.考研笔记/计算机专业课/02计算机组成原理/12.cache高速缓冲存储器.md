---
title: 12.计组 cache高速缓冲存储器
categories:
  - 开发学习笔记 markdown
  - 03.考研
  - 计算机专业课
  - 02计算机组成原理
---
![屏幕快照 2019-09-12 上午9.03.38](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.03.38.png)![屏幕快照 2019-09-12 上午9.04.25](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.04.25.png)
![屏幕快照 2019-09-12 上午9.22.36](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.22.36.png)

cache和主存之间的数据交互是以块为单位的

![屏幕快照 2019-09-12 上午9.23.50](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.23.50.png)
![屏幕快照 2019-09-12 上午9.26.51](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.26.51.png)

#性能分析
![屏幕快照 2019-09-12 上午9.29.16](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.29.16.png)

![屏幕快照 2019-09-12 上午9.31.08](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.31.08.png)
![屏幕快照 2019-09-12 上午9.32.02](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.32.02.png)


# 工作原理
![屏幕快照 2019-09-12 上午9.41.43](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.41.43.png)
![屏幕快照 2019-09-12 上午9.42.21](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.42.21.png)

![屏幕快照 2019-09-12 下午4.36.22](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.36.22-1.png)

# 地址映射
![屏幕快照 2019-09-12 上午9.43.52](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.43.52.png)
![屏幕快照 2019-09-12 上午9.51.37](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.51.37.png)
直接映射速度快 越靠近cpu的缓存越用直接映射

![屏幕快照 2019-09-12 上午9.54.42](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%889.54.42.png)
 j cache块号 i主存块号
 
 ![屏幕快照 2019-09-12 上午10.00.39](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%8810.00.39.png)
全相联命中率高

![屏幕快照 2019-09-12 上午10.03.59](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%8810.03.59.png)
折中方案：组间直接映射 组内全相联映射

![屏幕快照 2019-09-12 上午10.05.27](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%8810.05.27.png)
Q cache的组数  j 缓存的组号   i 主存的块号

![屏幕快照 2019-09-12 上午11.09.26](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8A%E5%8D%8811.09.26.png)


![屏幕快照 2019-09-12 下午3.16.34](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%883.16.34.png)
主存中 后六位是块内地址 蓝色三位是对应于cache的行号 
cache每行64字节 按字节编址
对应主存256MB的总容量 分成 256M/64= 2的23次方 个块 每块对应cache的每行

![屏幕快照 2019-09-12 下午3.18.21](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%883.18.21.png)
前22位作为有效位标记

![屏幕快照 2019-09-12 下午3.20.14](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%883.20.14.png)
前19位作为有效位标记

![屏幕快照 2019-09-12 下午3.30.01](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%883.30.01.png)
cache分成4组 组号是前两位 00 01 10 11

Q cache的组数  j cache的组号   i 主存的块号      j=i mod Q



# 替换策略
![屏幕快照 2019-09-12 下午4.33.24](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.33.24.png)

![屏幕快照 2019-09-12 下午3.58.23](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%883.58.23.png)
  ![屏幕快照 2019-09-12 下午4.15.49](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.15.49.png)![屏幕快照 2019-09-12 下午4.19.11](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.19.11.png)

![屏幕快照 2019-09-12 下午4.24.33](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.24.33.png)
二路组相联： cache每两行是一组
（对应的cache组号 除以4得到的余数 这里写错了）

![屏幕快照 2019-09-12 下午4.27.40](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.27.40.png)
计算时 列表：
先进先出 4块号先放第一组最下面 有其他进来了就往上浮 直到先进先出 出去

![屏幕快照 2019-09-12 下午4.30.14](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.30.14.png)
计算时 列表：
最近最少使用 4 进来 12 进来 都在第一组 4又命中时 把4放第一组下面 12 上抬 当8 进来时 12这个最近最少使用块号就从cache出去了

![屏幕快照 2019-09-12 下午4.31.04](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.31.04.png)


所以命中次数和映射方式 和 替换算法都有关系

# 写策略
![屏幕快照 2019-09-12 下午4.33.41](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.33.41.png)

![屏幕快照 2019-09-12 下午4.36.22](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.36.22.png)

## 写命中 命中cache的情况：
![屏幕快照 2019-09-12 下午4.40.12](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.40.12.png)

写回法：cache被修改 先不立即修改对应主存的内容 当cache的内容要被替换时，再修改主存
设置脏位：如果修改了 脏位设为1
![屏幕快照 2019-09-12 下午4.43.41](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.43.41.png)

全写法：立即修改 保持一致，但是增加了访存次数
采用写缓冲，先把数据存入写缓冲，在闲时把写缓冲的数据写入主存 但写命中 写操作频繁时写缓冲就会溢出。

## 写未命中的情况：
![屏幕快照 2019-09-12 下午4.45.33](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.45.33.png)
![屏幕快照 2019-09-12 下午4.46.10](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.46.10.png)

![屏幕快照 2019-09-12 下午4.45.58](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.45.58.png)

![屏幕快照 2019-09-12 下午4.52.01](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.52.01.png)
多级cache 现在一般cpu采用三级cache
L1 对与L2 采用全写法 
L2 对于主存 采用写回法

避免了写饱和溢出

## 总结
![屏幕快照 2019-09-12 下午4.52.58](https://raw.githubusercontent.com/ayrikiya/pic-store/main/ky/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-09-12%20%E4%B8%8B%E5%8D%884.52.58.png)

