# babel-plugin-import

在antd的使用中提到可以使用按需加载的模式引入组件代码，
这样配合less-loader的支持，就可以只写：
`import { Button } from 'antd';`
不用手动引入antd.css 或者全局引入antd的样式文件。
babel-plugin-import 会按需加载所要的组件如Button
并自动引入less样式文件。

其实就是分析了语法树自动加了针对使用组件的单独引入代码。

看使用babel-plugin-import时传入不同的options效果：
```
// { "libraryName": "antd" }
import { Button } from 'antd';
ReactDOM.render(<Button>xxxx</Button>);

      ↓ ↓ ↓ ↓ ↓ ↓

var _button = require('antd/lib/button');
ReactDOM.render(<_button>xxxx</_button>);


// { "libraryName": "antd", style: "css" }
import { Button } from 'antd';
ReactDOM.render(<Button>xxxx</Button>);

      ↓ ↓ ↓ ↓ ↓ ↓

var _button = require('antd/lib/button');
require('antd/lib/button/style/css');
ReactDOM.render(<_button>xxxx</_button>);


// { "libraryName": "antd", style: true }
import { Button } from 'antd';
ReactDOM.render(<Button>xxxx</Button>);

      ↓ ↓ ↓ ↓ ↓ ↓

var _button = require('antd/lib/button');
require('antd/lib/button/style');
ReactDOM.render(<_button>xxxx</_button>);
```
你也可以设置`"libraryDirectory": "es",` 来将lib改为es。这样可以区分cjs和ejs两种模块。

不使用babel-plugin-import时，当`import { Button } from 'antd';`打包时会将整个es模块代码引入。
使用babel-plugin-import时，只有用到的组件会被打包。

所以除了自动引入css/less/sass样式文件，也防止全量引入组件库。

# 用法：

使用babel-plugin-import 来按需加载组件代码和样式（antd）：
`npm install babel-plugin-import --save-dev`

配置项目打包文件：
通过 .babelrc 配置文件
或者webpack配置中 babel-loader 模块配置项
或在package.json中babel配置项：

```js
"babel": {
    "presets": [
        "react-app"
    ],
    "plugins": [
        [
            "import", 
            { 
                "libraryName": "antd", 
                "libraryDirectory": "es", 
                "style": true 
            } 
        ]
    ]
},
```

如果是craco：
```js
module.exports = {
    babel: {
        plugins: [
          // 配置 babel-plugin-import 按需加载antd组件
          // 在这里配置babel-plugin-import 就不用在package.json里配置了
          [
            "import",
            {
              libraryName: "antd",
              libraryDirectory: "es",
              // 按需加载定制less主题样式必须是true，style: 'css'是使用css文件没有样式变量 定制会失效
              style: true,
            },
            "antd",
          ],
          [
            "import",
            {
              libraryName: "ayri-ui",
              libraryDirectory: "es",
              // 按需加载定制less主题样式必须是true，style: 'css'是使用css文件没有样式变量 定制会失效
              // style: true,
            },
            "ayri-ui",
          ],
        ],
    },
}
```

如果你有多个库需要按需加载，使用多个plugins：
Options can't be an array in babel@7+, but you can add plugins with name to support multiple dependencies.

For Example:
```
// .babelrc

"plugins": [
  ["import", { "libraryName": "antd", "libraryDirectory": "lib"}, "antd"],
  ["import", { "libraryName": "antd-mobile", "libraryDirectory": "lib"}, "antd-mobile"]
]
```



