# 一些指标：
文档加载过程：
TTFB：从请求开始到接收第一字节的时间
DCL：DOM解析完毕
L：load，触发onLoad 事件，是页面依赖所有资源加载（下载）完的事件。
渲染呈现过程：
FP&FCP：
首次绘制像素（FP，可能是背景色或loading）。 FP一般在HTML解析完成或者解析一部分时候触发。
首次内容绘制时间（FCP）表示渲染出第一个内容，这里的"内容"可以是文本、图片、canvas。
FMP：首次渲染有意义的内容的时间，"有意义"没有一个标准的定义，FMP的计算方法也很复杂。
LCP：视窗内最大的元素绘制的时间
SI：页面加载过程中内容可视化显示的速度
FSP：从开始加载到首屏内容全部绘制完成的时间
交互过程：
TTI：网页首次完全达到可交互状态的时间点
FCI：页面首可交互时间
FID：首次输入延迟
FPS：每秒可以重新绘制的帧数，用于衡量应用流畅度
其中最重要的是白屏时间（FP&FCP）、首屏时间（FSP）、可交互时间（FCI）、可持续交互时间（TTI）

performance的几个有价值指标。
如设置一个5秒的耗时任务。

# DCL 5.03秒
DOM content loaded
Marks the point when the page's initial HTML document has been completely loaded and parsed, without waiting for stylesheets, images and subframes to finish loading.

DOMContentLoaded：当初始的 HTML 文档被完全加载和解析完成之后，**DOMContentLoaded **事件被触发，而无需等待样式表、图像和子框架的完全加载。
load: load 事件在整个页面及所有依赖资源如样式表和图片都已完成加载时触发。它与 DOMContentLoaded不同，后者只要页面 DOM 加载完成就触发，无需等待依赖资源的加载。

load事件强调的是从网络上加载数据，并不包括解析这些数据，而DOMContentLoaded是指加载完 HTML 数据(不包括样式、JS脚本等文件)并解析完才会触发。

那么，这两个事件谁先谁后触发就不一定了。
直接打开一个纯html文件，load事件比DCL先触发，如果加入加载一个图片，发现load事件比DCL之后触发。
所以，load事件和外部资源的加载强相关，如果页面有很多外部资源，load事件会在资源加载结束后触发，如果外部资源非常少甚至没有，都是dom，那么load事件大概率在DCL之前触发。

注意DCL只是dom被解析完成，即使FP FCP LCP 页面也会延迟一点点才出现实际绘制后的视觉效果。

# Load
页面依赖所有资源加载（下载）完的事件，太晚，也受资源加载成功失败的限制，一般不作为页面是否可用的指标。


# FP
First Paint
首次绘制时间，这个指标用于记录页面第一次绘制像素的时间。
FP小于等于FCP
FP 指的是绘制像素，比如说页面的背景色是灰色的，那么在显示灰色背景时就记录下了 FP 指标

```
performance.getEntriesByName('first-paint') 
```

但是此时 DOM 内容还没开始绘制，可能需要文件下载、解析等过程，只有当 DOM 内容发生变化才会触发，比如说渲染出了一段文字，此时就会记录下 FCP 指标

我们可以把这两个指标认为是和白屏时间相关的指标。


# FCP 5.05秒
First contentful paint
Measures the time from when the pages starts loading to when any part of the page's content is rendered on the screen.
该项指标会在用户首次在屏幕上看到任何内容时，在页面加载时间轴中标记出相应的点，迅捷的 FCP 有助于让用户确信某些事情正在进行。
0-1.8 好 1.8-3.0 一般 3以上不好 单位s

用监听的方式实现：
```js
new PerformanceObserver((entryList) => {
  for (const entry of entryList.getEntriesByName('first-contentful-paint')) {
    console.log('FCP candidate:', entry.startTime, entry);
  }
}).observe({type: 'paint', buffered: true});
```

但是实际的指标与api会存在很多场景上的差异，这些差异提高了我们对指标计算的复杂度，而chrom团队也不建议我们记住这些细微的差异，推荐我们使用web-vitals库测量FCP。


优化fcp：
script标签和link标签在一般情况下都会阻塞渲染。

判断什么是关键资源。Chrome DevTools 的coverage选项卡可以识别到css和js 加载了多少代码，使用了多少这些加载的代码。我们尽量传输首次绘制我们所需的css样式和js代码。

# FMP
First Meaningful Paint，是指页面的首要内容出现在屏幕上的时间，对于不同的站点，首要内容是不同的，例如：

博客文章：【大标题 + 首屏文字】是首要内容；
百度或 Google 的搜索结果页：【首屏的结果】就是首要内容；
淘宝等购物网站：【图片】会极为重要，因此它是首要内容；
在 Lighthouse 6.0 中已不推荐使用 FMP，建议使用 LCP 代替

# LCP 5.05秒
Largest contentful paint
Marks the point in the page load timeline when the page's main content has likely loaded.
最大内容绘制时间，用于记录视窗内最大的元素绘制的时间，该时间会随着页面渲染变化而变化，因为页面中的最大元素在渲染过程中可能会发生改变，另外该指标会在用户第一次交互后停止记录。

LCP 其实能比 FP、FCP、FMP 更能体现一个页面的性能好坏程度，因为这个指标会持续更新。举个例子：当页面出现骨架屏或者 Loading 动画时 FCP 其实已经被记录下来了，但此时页面内容其实并未呈现。

LCP 目前并不会计算所有元素，因为这样会使这个指标变得非常复杂，它现在只关注下面的元素：

<img> 元素
<image>元素内的<svg>元素
<video> 元素
通过 url() 函数加载背景图片的元素
包含文本节点或其他内联文本元素子级的块级元素。


# TTI 5.05秒
Time to Interactive
Measures the time from when the page starts loading to when its main sub-resources have loaded and it is capable of reliably responding to user input quickly.
从 FCP 指标后开始计算；
持续 5 秒内无长任务（执行时间超过 50 ms）且无两个以上正在进行中的 GET 请求；
往前回溯至 5 秒前的最后一个长任务结束的时间。



# 解释一些指标区别
## FP和FCP LCP
FP之前叫做白屏时间，FP到FCP是dom内容绘制阶段，FCP到LCP是最大的dom元素绘制阶段(一般不做优化的化，两者时间是一致的)
浏览器渲染的界面可能是"内容"，例如文本，（触发FCP）
也可能不是"内容"，比如一个背景为红色的div标签。（触发FP）
FCP事件指渲染出第一个内容的事件，而FP指渲染出第一个像素点，渲染出的东西可能是内容，也可能不是。

有节点不一定有渲染，如果没有任何样式，是没有界面的，也不需要渲染。下面代码就没有 FP FCP事件。只有L和DCL。
```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>no FP</title>
  </head>
  <body>
    <div></div>
  </body>
</html>
```

下面代码，会渲染界面，因此会触发FP事件，但是不会触发FCP，因为没有内容: 只有DCL L FP
```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>has FP, no FCP</title>
    <style>
        div {
            width: 1px;
            height: 1px;
            background-color: red;
        }
    </style>
</head>
<body>
    <div></div>
</body>
</html>

```
如果html本身有内容（文本、图片）或者js脚本很快能创建内容，那么FP和FCP会一起触发。否则FP比FCP提前触发。FP肯定不会在FCP后面出现，因为渲染出内容，一定也渲染出了像素。

## FP 与 DCL 的先后顺序
浏览器不一定等到所有的DOM都解析完再开始渲染，如果DOM节点少，浏览器会加载完再渲染，但是如果节点很多，浏览器解析一部分节点后就会开始渲染（这时候就会触发FP）。也就是说，当需要渲染的节点数少的时候，DCL会在FP前面；当需要渲染的节点数很多时候，DCL会在FP后面。

我们可以打开百度官网来查看下performance面板，因为页面DOM节点较多，所以先触发FP。
现在来说，绝大部分的项目都是FP在DCL之前触发，这样用户可以更快的看到页面内容。

## DCL和L
DCL和L，一般来说都是DCL在前，极少部分页面是L在前面。因为Load衡量的是资源的下载情况，DCL是dom构建情况。
优化DCL，dom解析完成，实际上 没有太多优化的点（长耗时js会阻塞dom解析，进而阻塞DCL等指标的触发）。
优化L，属于页面的整体优化。
首页资源分割+懒加载
预解析+预连接
http1.x==>http2.0
资源开启gzip压缩，js/css文件压缩
使用http缓存或者service worker