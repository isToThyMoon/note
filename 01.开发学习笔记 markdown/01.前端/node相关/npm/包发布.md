# 发布一个自己的npm包
注册npm账户

先切换官方镜像源。
`npm config set registry http://registry.npmjs.org/ `
或者nrm切换源

检测当前账号是否登录：
`npm whoami`

如果未登录，则使用 `npm adduser` 进行账号登录

在发布到 NPM 之前，还需配置 package.json 文件，添加一些必要的描述信息：
如package.json中 files 关键字确定你需要上传的文件夹 组件库最好使用dist es lib

prepublish提供钩子在publish之前要执行的工作：` "prepublishOnly": "npm run test:nowatch && npm run lint && npm run build" `

具体：
```
将 private 字段置为 false , 表示非私有包；

添加 description 、 author 、 license 、 keywords 等相关字段;

添加 homepage 字段，即项目主页URL；

添加 repository 字段，即项目仓库地址URL；

添加 files 字段，表示要将哪些文件上传到 npm 上去。如果什么都不写，则默认会使用 .gitignore 里面的信息。但要注意，不管 .gitignore 怎么配置，一些文件会始终发布到 package 上，这些文件包括 package.json 、 README.md 、 LICENSE 等等；

添加 prepublishOnly 钩子函数，在该钩子函数中运行 npm run build ，用来确保 NPM 包发布之前采用的是最新编译的代码；
```

配置 peerDependencies 字段，提示该库的核心依赖，当使用 npm install 安装依赖时， peerDependencies 声明的依赖不会被自动安装，而是通过输出 warining 日志告诉用户需安装以下依赖。
例如开发了一个react的组件库，那么默认用户应该安装过react，但会对版本有些要求，这就要配置peerDependencies。

除此外可以配置一些代码规范和单元测试检查，当然这不是主要流程：

## 代码规范检查和单元测试检查
对于一个组件库来说，代码质量是非常重要的。为了防止不符合团队规范的代码或未通过单元测试的代码被commit 亦或者被 publish，需要使用一些钩子函数来验证开发者是否通过代码规范检查和单元测试检查。

### 添加代码规范检查
在  package.json文件中，添加 lint 脚本，针对 src 目录下的文件进行 eslint 检查。

` "lint": "eslint --ext js,ts,tsx, src --max-warnings 5",`

--max-warnings 5 : 表示最大允许的 warnings 警告是 5；

### 添加单元测试检查
在使用 CRA 创建项目时，默认会创建 test 脚本，但该脚本是用于开发环境，执行完后不会返回执行结果(即不会返回执行通过还是未通过)，而是一直处于 watch 模式下。针对这一情况，可以设置环境变量 CI=true ，即可返回测试运行结果。

` "test:nowatch": "cross-env CI=true npm run test"`

在不同的操作系统环境下，设置环境变量方式不一样。故需借助 cross-env 依赖包完成跨平台的环境变量设置。

### commit 或 publish 前的流程检查
针对 commit 代码，安装 husky 依赖，在代码提交前先进行单元测试检查和代码规范检测，如下所示。在发布NPM 包之前也进行同样配置。

```
"scripts": {    
    ...,    
    "prepublishOnly": "npm run test:nowatch && npm run lint && npm run build"  
},  
"husky": {    
    "hooks": {      
        "pre-commit": "npm run test:nowatch && npm run lint"    
    }  
},
```

完成上述配置后，运行命令 npm publish 即可完成 NPM 包的发布。


# package.json中入口文件设置
例如antd有三种入口，

"main": "lib/index.js",
"module": "es/index.js",
"typings": "es/index.d.ts",
"unpkg": "dist/antd.min.js",


main是commonJS规范的入口，require('antd')时使用。
module是ESM规范的入口，使用import xxx from 'antd'这种引用方式会使用。
unpkg是UMD规范的入口，通过script标签引入时候或者commonJS方式都可以使用。 

typings是类型文件入口

官方网站中对main的解释是：这是一个项目的入口文件。如果你的模块命名为foo，npm installs foo,然后在项目里require("foo") ,那么main中指向的文件的module's exports 对象将被返回。