---
title: 02.set map类型
categories:
  - 01.开发学习笔记 markdown
  - 06.JavaScript
  - es6
---

es6新数据类型：

# Map
Map 对象保存键值对，并且能够记住键的原始插入顺序。任何值（对象或者基本类型）都可以作为一个键或一个值。

JavaScript的默认对象表示方式`{}`可以视为其他语言中的Map或Dictionary的数据结构，即一组键值对。
但是JavaScript的对象有个小问题，就是键必须是字符串。但实际上Number或者其他数据类型作为键也是非常合理的。为了解决这个问题，最新的ES6规范引入了新的数据类型Map

Map 和 Object 很相似
在其他语言中 通常会有 dict 和 object 两种数据结构
现在 js 也有独立的 dict 那就是 Map(其实没多好用)


用法如下
`var m = new Map()`
// set 方法增加一个值
`m.set('name', 'dada')`
// get 属性得到一个值
`m.get('name')`
// 看起来是比 Object 恶心多了.....

```js
let o = {}
o.name = 'dada'
o.name
```

------------------

# Set
Set和Map类似，一组key的集合，但不存储value。由于key不能重复，所以，在Set中，没有重复的key。

Set 在其他语言里面称为集合
是一种和 Array 相似的数据结构 list
不同之处在于, Set 中的元素都是不重复的
用法如下

var s = new Set()

// add 方法添加元素, 和 push 一样

    s.add(1)
    s.add(2)

// has 方法检查元素是否在 set 中
    
    s.has(1) // true
    s.has(3) // false

// size 属性相当于 length
   
    s.size  // 2

// delete 方法删除一个元素
   
    s.delete(1)
    s.has(1)
    s.size  // 1

set 类型的主要作用是去重

------------------

# WeakMap

`WeakMap` 是 JavaScript 中的一种数据结构，用于存储键-值对。与普通的 `Map` 不同，`WeakMap` 使用弱引用来存储键，这意味着它不会阻止键对象被垃圾回收器回收。这对于一些特定的使用情况非常有用，如实现私有字段（Private Fields）或在不需要强引用的情况下关联对象。

主要特点和用途：

1. **弱引用**：`WeakMap` 的键必须是对象，而值可以是任意数据类型。键对象是弱引用，这意味着如果没有其他引用指向键对象，它可以被垃圾回收，这将导致与之关联的键-值对被自动移除。

2. **安全的私有字段**：`WeakMap` 可用于实现类的私有字段，因为外部代码无法直接访问或修改 `WeakMap` 中的内容。

```javascript
const privateData = new WeakMap();

class MyClass {
  constructor() {
    privateData.set(this, { key: "value" });
  }

  getPrivateValue() {
    return privateData.get(this).key;
  }
}

const instance = new MyClass();
console.log(instance.getPrivateValue()); // "value"
console.log(instance.privateData); // undefined
```

3. **对象生命周期跟踪**：`WeakMap` 可用于跟踪对象的生命周期。当对象被销毁时，与之关联的键-值对也会被自动清理，这可以减少内存泄漏的风险。

4. **高级用途**：`WeakMap` 还可用于一些高级用途，如实现缓存、跟踪 DOM 元素的关系等。

需要注意的是，`WeakMap` 具有一些限制：
- 无法遍历：`WeakMap` 不能直接遍历键-值对，因为键是弱引用。因此，它没有类似 `Map` 的 `forEach` 方法。
- 仅限于对象：键必须是对象，不能是原始数据类型。
- 不能访问大小或键的数量：`WeakMap` 没有 `size` 属性或类似 `Map` 的 `keys`、`values` 和 `entries` 方法。

`WeakMap` 是一个强大而有用的工具，特别适用于需要弱引用的场景，以减少内存泄漏和增强隐私的情况。

# WeakMap和Map区别对比
`Map` 和 `WeakMap` 是 JavaScript 中用于存储键-值对的两种数据结构，它们有以下主要区别：

1. **强引用 vs. 弱引用**：
   - `Map` 使用强引用，这意味着当一个对象被存储在 `Map` 中时，该对象会阻止垃圾回收器回收它，即使没有其他引用指向这个对象。
   - `WeakMap` 使用弱引用，这意味着当一个对象被存储在 `WeakMap` 中时，这个对象不会阻止垃圾回收器回收它，除非存在其他强引用指向这个对象。

2. **键的类型**：
   - 在 `Map` 中，键可以是任何数据类型，包括原始类型（如字符串、数字）和对象。
   - 在 `WeakMap` 中，键必须是对象，不能是原始类型。

3. **遍历**：
   - 由于 `Map` 使用强引用，它的键和值可以被正常遍历。
   - 由于 `WeakMap` 使用弱引用，它的键和值不能被直接遍历。`WeakMap` 没有提供类似 `Map` 中的 `forEach` 方法，因为这可能会导致访问已被回收的对象。

4. **性能**：
   - 由于 `Map` 使用强引用，它的性能通常比 `WeakMap` 更好，因为它不需要额外的垃圾回收工作。
   - `WeakMap` 对于特定用途，如实现私有字段（Private Fields）或跟踪对象生命周期，非常有用。

5. **用途**：
   - `Map` 通常用于需要存储键值对的一般情况，其中键和值都需要强引用。
   - `WeakMap` 通常用于需要存储对象之间的关系，但不需要阻止垃圾回收的情况，如实现私有字段或对象的临时关联。

总之，你应该根据你的需求来选择使用 `Map` 还是 `WeakMap`。如果你需要强引用并希望能够遍历键值对，那么 `Map` 是更好的选择。如果你需要建立临时关系，不想阻止对象被回收，或需要实现一些高级用例，那么 `WeakMap` 可能更适合。