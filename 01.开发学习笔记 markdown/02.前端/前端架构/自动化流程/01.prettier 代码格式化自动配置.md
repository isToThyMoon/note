# prettier

不同的人用不同的ide可能都有一套代码格式化的规范，为了保持统一，我们需要同一套配置。

安装prettier
npm i -D --save-exact prettier

编写配置文件
echo {} > .prettierrc.json

.prettierrc.json文件控制配置
```
{
    "printWidth": 80, //单行长度
    "tabWidth": 2, //缩进长度
    "useTabs": true, //使用tab缩进
    "semi": true, //句末使用分号
    "singleQuote": true, //使用单引号
    "quoteProps": "as-needed", //仅在必需时为对象的key添加引号
    "jsxSingleQuote": true, // jsx中使用单引号
    "trailingComma": "all", //多行时尽可能打印尾随逗号
    "bracketSpacing": true, //在对象前后添加空格-eg: { foo: bar }
    "jsxBracketSameLine": true, //多属性html标签的‘>’折行放置
    "arrowParens": "always", //单参数箭头函数参数周围使用圆括号-eg: (x) => x
    "requirePragma": false, //无需顶部注释即可格式化
    "insertPragma": false, //在已被preitter格式化的文件顶部加上标注
    "proseWrap": "preserve", 
    "htmlWhitespaceSensitivity": "ignore", //对HTML全局空白不敏感
    "vueIndentScriptAndStyle": false, //不对vue中的script及style标签缩进
    "endOfLine": "lf", //结束行形式
    "embeddedLanguageFormatting": "auto", //对引用代码进行格式化

}
```


.prettierignore功能类似.gitignore 配置哪些文件可以忽略不用格式化
默认
```
build
coverage
```

手动格式化命令：
yarn prettier --write .

当然我们的开发需要的是自动化配置，不会每次手动格式化。
我们需要pre-commit-hook 每次代码提交前自动格式化。

# 预准备
prettier自带eslint，
package.json中已经有了eslint配置，但prettier和eslint同时工作会有冲突（eslint中有对格式化的配置，prettier是针对格式化的工具 希望关闭eslint中格式相关功能，额外使用prettier负责格式化），我们需要做些配置。
安装eslint-config-prettier

`npm i eslint-config-prettier -D`
在eslint中继承配置，以.eslintrc.json为例：
```
{
    "extends": ["prettier"]
}
```
或者
配置package.json

```json
{
    "eslintConfig": {
        "rules": {
          "@typescript-eslint/no-unused-vars": "off"
        },
        "extends": [
          "react-app",
          "react-app/jest",
          "prettier" //表示使用prettier的规则，覆盖上面部分规则，协同工作
        ]
    },
}
```

# pre-commit-hook实现提交前自动格式化

## 方法一是lint-staged：
`npx mrm@2 lint-staged`

为我们安装了 husky和 lint-staged并在package.json中写入相关配置内容
这个命令会根据package.json中的相关依赖自动安装配置lint-staged。所以前提先完成eslint和prettier安装。

也可以完全手动安装整个过程，更加清晰可控：
`npm install -D husky lint-staged`

其中husky用于git hooks管理。
新版本husky在根目录下创建.husky文件夹统一管理执行脚本了，无需在package.json中配置husky字段。
```json
{   
    "husky":{
        "hooks": {
            "pre-commit": "lint-staged"
        }
    },
    
    "lint-staged": {
        "*.{js,css,md,ts,tsx}": "prettier --write"
    }
}
```
这里package.json的意思就是在pre-commit阶段运行lint-staged，而lint-staged对以js,css,md,ts,tsx为后缀的文件执行prettier自动格式化。





配置完成 这样在下一次git commit前，prettier会自动格式化我们的文件

## 方法2 pretty-quick
`npx husky-init`
`npm install -D pretty-quick`

其中husky方便git hooks管理，pretty-quick可以更加高效执行prettier。