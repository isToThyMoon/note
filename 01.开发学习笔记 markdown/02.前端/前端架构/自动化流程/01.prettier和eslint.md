VSCode 中安装的是在编辑器里面用的，
如果项目根目录下有 eslintrc 和 prettierrc 配置文件，VSCode 插件会自动读取配置文件中的配置检查你的代码和格式化文件。
npm 安装的是在命令行中运行的。如果想要实时lint提示，需要安装vscode的插件，当然vscode自带了ts js语法检查。
如果你只安装 npm 包，VSCode 是不会有 lint 提示的，只能通过命令行，在小黑窗查看不符合 lint 规则的检测信息。
安装 npm 包最主要的原因是可以通过 git hook 强制提交代码前 lint 和格式化代码保证代码仓库的代码风格统一。

## eslint
ESLint和Prettier，他们分别提供了对应的vscode的插件，二者在代码格式化方面有重叠的部分，规则不一致时会导致冲突。

首先，需要在vscode中安装ESLint插件并启用，同时需要在vscode配置中开启eslint的检查。
setting.json
```json
{
    "eslint.enable": true, // 开启eslint检查
}
```

其次，需要在当前项目根目录或者全局安装eslint，

```
pnpm i eslint -D -w
```
初始化：
```
npx eslint --init
```
初始化时会按选择的配置提示安装一些规则配置项的库：
```
The config that you've selected requires the following dependencies:
@typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest
```
选择安装即可。

也可自行安装，如安装ts的eslint插件：

```
pnpm i -D -w @typescript-eslint/eslint-plugin 
```

若没有安装，则会在vsconde的eslint控制台输出错误。

最后，需要在项目根目录有配置文件.eslintrc.js或者.eslintrc.json，或者在根项目的package.json中配置项eslintConfig中配置eslint的规则。

.eslintrc.json如下：
```
{
   "env": {
    "browser": true,
    "es2021": true,
    "node": true
   },
   // 有了plugins等定义的一系列规则，这些规则是否是打开，要在extends里配置，如下就是一些recommended推荐打开的配置，已经设置好了。
   "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier",
    "plugin:prettier/recommended"
   ],
   // parser, 用什么解析器把ts/js代码解析成AST语法树，默认的eslint是没有办法解析ts代码的。
   "parser": "@typescript-eslint/parser",
   // parser的配置
   "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module"
   },
   // plugins定义了一些插件，实现一些功能和规则检查合集
   "plugins": ["@typescript-eslint", "prettier"],
   // 具体的eslint检查规则 除了别人规定好的规则集合，你可以自定义某些具体的配置以符合你的要求和喜好
   "rules": {
    "prettier/prettier": "error",
    "no-case-declarations": "off",
    "no-constant-condition": "off",
    "@typescript-eslint/ban-ts-comment": "off"
   }
}
```

若没有任何配置文件，则eslint控制台会输出如下错误：No ESLint configuration found in.....

上面三个步骤缺一不可，都配置完后我们在vscode编辑中就能看到代码被eslint检查的结果。

其实，vscode可以用eslint在文件保存时对部分的问题代码进行自动修复，这需要在vscode配置eslint进行文件保存时自动格式化代码，具体是通过vscode的codeActionsOnSave.source.fixAll来设置。
setting.json
```
{
    "eslint.enable": true, // 开启eslint检查
    "editor.codeActionsOnSave": {
        // 使用eslint来fix，包括格式化会自动fix和代码质量检查会给出错误提示
        "source.fixAll.eslint": true
      }
}
```

但一般来说，eslint和prettier都提供了格式化功能，我们只使用eslint的检查，格式化交给prettier。自动fix代码校验的错误也不利于我们对代码的掌控。何况有些lint检查错误是要手动修改代码的。

而且：
ESLint 安装和配置比较麻烦，而且 lint 的速度并不快。
Prettier 并不只针对 JavaScript，它可以格式化各种流行语言。
Prettier 的配置选项没那么眼花缭乱，比 ESLint 少很多，这在Prettier选项的哲学中说明精简的原因。

## prettier
https://prettier.io/docs/en/instal
不同的人用不同的ide可能都有一套代码格式化的规范，为了保持统一，我们需要同一套配置。

在vscode中启用Prettier相对来说比较简单，并不需要在当前项目中安装Prettier，只需：在vscode中安装Prettier插件并启用，同时需要设置Prettier为对应的代码默认格式化，或者将其设置为指定语言的代码格式化。

命令行在项目中安装prettier模块，也是为了在commit时自动对代码进行fomat。
```
pnpm i prettier -D -w

# 安装prettier
npm i -D --save-exact prettier
```

安装了prettier插件后可以在setting.json中配置默认格式化选项。（请注意json中不要携带注释，大部分情况下编译器不支持）
这些配置会覆盖 prettier-vscode 插件捆绑的 prettier 的默认格式化选项。
```json
{
  "editor.defaultFormatter": "esbenp.prettier-vscode", // 设置编辑器的默认格式化工具为 prettier
  "editor.formatOnSave": true, // 开启保存文件自动格式化代码
  "prettier.requireConfig": false // 是否需要项目中强制险配置Prettier的配置文件
  "[javascript]": { // 根据语言设置其对应的默认格式化工具
      "editor.defaultFormatter": "esbenp.prettier-vscode", // 设置 javascript 的默认格式化工具为 prettier
      "editor.formatOnSave": true, // 保存的时候自动格式化
  },
  // prettier 选项配置,这些配置会覆盖 prettier-vscode 插件捆绑的 prettier 的默认格式化选项
  "prettier.semi": false, // 语句末尾添加分号
  "prettier.singleQuote": true // 使用单引号
}
```

在调用prettier插件格式化时，
Prettier插件获取配置文件有一个优先级：.prettierrc.json > .editorconfig > vscode默认配置 > prettier-vscode 插件捆绑的 prettier 的默认格式化选项。

.prettierrc和.editorconfig同时存在时，二者内容会进行合并，若配置项有冲突，这.prettierrc的优先级更高。

新建.prettierrc.json配置文件`echo {} > .prettierrc.json`，添加配置：
```
{
 "printWidth": 80,
 "tabWidth": 2,
 "useTabs": true,
 "singleQuote": true,
 "semi": true,
 "trailingComma": "none",
 "bracketSpacing": true
}
```
完整的配置可以看官网介绍：
```
{
    "printWidth": 80, //单行长度
    "tabWidth": 2, //缩进长度
    "useTabs": true, //使用tab缩进
    "semi": true, //句末使用分号
    "singleQuote": true, //使用单引号
    "quoteProps": "as-needed", //仅在必需时为对象的key添加引号
    "jsxSingleQuote": true, // jsx中使用单引号
    "trailingComma": "all", //多行时尽可能打印尾随逗号
    "bracketSpacing": true, //在对象前后添加空格-eg: { foo: bar }
    "jsxBracketSameLine": true, //多属性html标签的‘>’折行放置
    "arrowParens": "always", //单参数箭头函数参数周围使用圆括号-eg: (x) => x
    "requirePragma": false, //无需顶部注释即可格式化
    "insertPragma": false, //在已被preitter格式化的文件顶部加上标注
    "proseWrap": "preserve", 
    "htmlWhitespaceSensitivity": "ignore", //对HTML全局空白不敏感
    "vueIndentScriptAndStyle": false, //不对vue中的script及style标签缩进
    "endOfLine": "lf", //结束行形式
    "embeddedLanguageFormatting": "auto", //对引用代码进行格式化
}
```

.prettierignore功能类似.gitignore 配置哪些文件可以忽略不用格式化
默认
```
build
coverage
```

手动格式化命令：
yarn prettier --write .

当然我们的开发需要的是自动化配置，不会每次手动格式化。
pre-commit-hook 每次代码提交前自动格式化。

# eslint和prettier冲突
prettier和eslint同时工作会有冲突（eslint中有对格式化的配置，prettier是针对格式化的工具 希望关闭eslint中格式化相关功能，额外使用prettier负责格式化），需要做些配置。

将prettier集成到eslint中，其中：

eslint-config-prettier：会关闭ESLint中有关代码格式化的配置 覆盖ESLint本身的规则配置 
eslint-plugin-prettier：用Prettier来接管修复代码即eslint --fix。把Prettier配置成ESLint的一个插件，让其当做一个linter规则来运行

安装：
`pnpm i eslint-config-prettier eslint-plugin-prettier -D -w`

在package.json中可以为lint增加对应的执行脚本，并验证效果：

```
"lint": "eslint --ext .ts,.jsx,.tsx --fix --quiet ./packages"****
```

验证成功后，安装prettier与eslint的VSCode插件，并在setting中设置为保存后自动执行。

```
{
  "editor.defaultFormatter": "esbenp.prettier-vscode", // 设置编辑器的默认格式化工具为 prettier
  "editor.formatOnSave": true, // 开启保存文件自动格式化代码
}
```


在eslint中继承配置，以.eslintrc.json为例：
```
{
   "env": {
    "browser": true,
    "es2021": true,
    "node": true
   },
   "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier",
    "plugin:prettier/recommended"
   ],
   "parser": "@typescript-eslint/parser",
   "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module"
   },
   "plugins": ["@typescript-eslint", "prettier"],
   "rules": {
    "prettier/prettier": "error",
    "no-case-declarations": "off",
    "no-constant-condition": "off",
    "@typescript-eslint/ban-ts-comment": "off"
   }
}
```

或者
配置package.json

```json
{
    "eslintConfig": {
        "rules": {
          "@typescript-eslint/no-unused-vars": "off"
        },
        "extends": [
          "react-app",
          "react-app/jest",
          "prettier" //表示使用prettier的规则，覆盖上面部分规则，协同工作
        ]
    },
}
```

另外，你可能会发现，针对有问题的代码，鼠标悬浮时有ts检查和eslint检查两条警告提示。如果我们只想用其中一个就行：
setting.json
```
{
    "typescript.validate.enable": false,
    "javascript.validate.enable": false,
}
```



## commit规范检查：
安装husky，用于拦截commit命令：
```
pnpm i husky -D -w
```

安装husky，用于拦截commit命令：
```
pnpm i husky -D -w
```

将刚才实现的格式化命令pnpm lint纳入commit时husky将执行的脚本：
```
npx husky add .husky/pre-commit "pnpm lint"
```

TODO：pnpm lint会对代码全量检查，当项目复杂后执行速度可能比较慢，届时可以考虑使用lint-staged，实现只对暂存区代码进行检查

通过commitlint对git提交信息进行检查，首先安装必要的库：
```
pnpm i commitlint @commitlint/cli @commitlint/config-conventional -D -w
```

新建配置文件.commitlintrc.js：
```
module.exports = {
  extends: ["@commitlint/config-conventional"]
}; 
```

集成到husky中：
```
npx husky add .husky/commit-msg "npx --no-install commitlint -e $HUSKY_GIT_PARAMS"
```