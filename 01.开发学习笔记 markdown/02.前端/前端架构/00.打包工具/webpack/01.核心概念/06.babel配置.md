---
title: 06.babel配置
categories:
  - 01.开发学习笔记 markdown
  - 08.前端框架
  - 05.webpack
  - 核心概念
---


前面提到webpack是一个模块打包工具而不是翻译器，webpack只识别了多种标准导出引入的语法。

真正js的翻译器，也是把js推向大规模可用的工具就是babel，它把暂时还不被大部分浏览器实现的ECMAscript标准语法翻译成已经被实现的旧语法。

具体安装和使用配置见babel官网，下面仅是一些最小实例。

`npm install babel-loader @babel/core --save-dev`

loader只是把webpack和babel做了一个打通连接，还需要babel/preset-env 它存储了翻译相关的语法规则

`npm install @babel/preset-env --save-dev`

光能翻译语法还不够，低版本的浏览器可能没有promise这样的类的实现，需要对这些新增加的类做一个polyfill

npm install @babel/polyfill

在相关的业务代码页面 比如index.js中使用了promise的语法 那么在开头引入polyfill 
在config文件中配合preset的设置控制是否按需加载相关类的ployfill
import "@babel/polyfill";


不想每次在相关业务代码中都写一行引入polyfill，也可以采用第二种方式 runtime：

`npm install --save-dev @babel/plugin-transform-runtime （开发环境使用）`
`npm install --save @babel/runtime  (生产环境使用)`

因为配置项中core.js 值为2 需要安装下：
npm install --save @babel/runtime-corejs2

# 实现对react语法的翻译打包

先安装presets

npm install --save-dev @babel/preset-react

配置config文件相关项
{"presets": ["@babel/preset-react"]}




# 编译打包react

## 我们的工程用什么把 TS 编译成 JS 文件？

可能会觉得既然我们用ts那肯定是tsc编译的，其实不是，
目前大多数的ts工程都是 ts类型检查 + babel编译 这样的组合，我们的工程也不例外
(可以去项目node_modules下面看一下，会发现有个@babel文件夹)

用babel编译ts，就可以实现这样一种效果：babel编译一切，降低开发/配置成本

而我们代码中的jsx/tsx文件并不是ts，就是用[@babel/plugin-transform-react-jsx](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx)这个babel插件转换的。

## 为什么每个组件文件开头都要引入 React?

每个组件开头都引入：`import React from 'react'`

之所以这么做的原因是，jsx只是个语法糖，上文中的那个插件，会把以下jsx：

```jsx
import React from 'react';

function App() {
  return <h1>Hello World</h1>;
}

```

转换成：

```jsx
import React from 'react';

function App() {
  return React.createElement('h1', null, 'Hello world');
}

```

大家看到转换出来的结果是要用`React`变量的，所以必须要引入`React`以保证它在作用域中

## 为什么又说不需要再引入React了？

因为上面说的那种转换方式是上一个版本的转换方式了。

plugin-transform-react-jsx 发布了新版本，从 v7.9.0开始，就不用手动引入`React`了，因为转换变成这样了：

```jsx
const profile = (
  <div>
    <img src="avatar.png" className="profile" />
    <h3>{[user.firstName, user.lastName].join(" ")}</h3>
  </div>
);

```

编译成：

```jsx
import { jsx as _jsx } from "react/jsx-runtime";
import { jsxs as _jsxs } from "react/jsx-runtime";

const profile = _jsxs("div", {
  children: [
    _jsx("img", {
      src: "avatar.png",
      className: "profile",
    }),
    _jsx("h3", {
      children: [user.firstName, user.lastName].join(" "),
    }),
  ],
});

```

所以就可以摆脱手动引入React了

这个功能默认是关闭的，但是从 create-react-app 4.0 开始，默认就是打开的了。
而4.0版本是2020年10月24号(https://github.com/facebook/create-react-app/releases/tag/v4.0.0)发布的，所以大家创建的工程是默认自动转换的。

**总之cra4以后的工程不需要手动引入 React，如果你自行搭建脚手架，你需要自行配置相关babel配置。**