---
title: 10.动态组件和异步组件 keep-alive
categories:
  - 01.开发学习笔记 markdown
  - 08.前端框架
  - 04.vue
  - 组件化
---

动态组件：根据数据的变化，结合component这个标签，来随时动态切换组件的显示。

异步组件：把一个大的项目拆分成很多小的代码片段，在需要的时候按需传入js文件异步加载合适的组件。

# 动态组件
实现一个toggle功能 点击button交替显示两个组件

用v-if或者v-show来实现：
```html
<div id="root">
    <child-one v-if="type === 'child-one'"></child-one>
    <child-one v-if="type === 'child-one'"></child-one>
    <button @click="handleBtnClick">change<button>
</div>

<script src="vue.js"></script>

<script>
    Vue.component('child-one', {
        template: `<div v-once>child-one</div>`
    })
    Vue.component('child-two', {
        template: `<div v-once>child-two</div>`
    })

    var VM = new Vue({
        el: '#root',
        data: {
            type: 'child-one'
        }
        methods: {
            handleBtnClick: function() {
                this.type = this.type === 'child-one' ? 'child-two' : 'child-one';
            }
        }
    }) 
</script>

```

这样代码量有点大而繁琐

用动态组件来实现：
`<component :is="type"></component>`

type是你需要切换的组件名name。

外层的keep-alive标签作用是，假如一个待切换组件是input框，在切换时会保存你之前的输入内容，下次切换回来记录仍然保留。有一个缓存的特性。

```html
<div id="root">
    <keep-alive>
    <component :is="type" />
    </keep-alive>
    <button @click="handleBtnClick">change<button>
</div>

<script src="vue.js"></script>

<script>
    Vue.component('child-one', {
        template: `<div>child-one</div>`
    })
    Vue.component('child-two', {
        template: `<div>child-two</div>`
    })

    var VM = new Vue({
        el: '#root',
        data: {
            type: 'child-one'
        }
        methods: {
            handleBtnClick: function() {
                this.type = this.type === 'child-one' ? 'child-two' : 'child-one';
            }
        }
    }) 
</script>

```

## 动态组件解决与html5标准冲突的tr bug

写table这类 组件上有渲染bug

tbody下只能是tr

还有ul下只能是li

select下只能是option

```jsx
<div id="root">
	<table>
    	<tbody>
            <row></row>
            <row></row>
            <row></row>
        </tbody>
    </table>
</div>

<script>
	Vue.component('row', {
        template: '<tr><td>this is a row</td></tr>'
    })
    
    var vm = new Vue({
        el: '#root'
    })
</script>
```

因为在html标准里tbody下是tr td

这里用row渲染就会出问题，最后三个tr与tbody同级且在tbody前面。

借助vue的is属性解决问题。（动态组件）

```jsx
<div id="root">tr
	<table>
    	<tbody>
            <tr is="row"></tr>
            <tr is="row"></tr>
            <tr is="row"></tr>
        </tbody>
    </table>
</div>

<script>
	Vue.component('row', {
        template: '<tr><td>this is a row</td></tr>'
    })
    
    var vm = new Vue({
        el: '#root'
    })
</script>
```

这样既符合vue特性，也不违反html标准，渲染正常。


## v-once
在v-if来切换时，在v-if值为false时vue会在内存销毁这个组件，为true时在内存创建这个组建。这样子在组件需要不断显示隐藏时是会损耗一定性能的。
所以我们在组件定义时模版内加上v-once指令。在创建销毁时暂存在内存中，提高一些静态内容的展示性能。
```js
    Vue.component('child-one', {
        template: `<div v-once>child-one</div>`
    })
```

# 异步组件

```js
const app = Vue.createApp({
    data(){
        return{
            content: 'dadada'
        }
    },

    template: `
        <div><async-test v-bind:content="content" dididi="dididi" /></div>
    `
});

app.component('async-test', Vue.defineAsyncComponent(()=>{
    return new Promise((resolve, reject)=>{
        setTimeout(()=>{
            resolve({
                template: `
                    <div>this is a asyncComponent</div>
                `
            })
        }, 4000)
    })
}));
app.mount('#root');
```

# keep-alive
keep-alive 是 Vue 内置的一个组件，可以使被包含的组件保留状态，避免重新渲染 ，其有以下特性：

1. 一般结合路由和动态组件一起使用，用于缓存组件；
2. 提供 include 和 exclude 属性，两者都支持字符串或正则表达式， include 表示只有名称匹配的组件会被缓存，exclude 表示任何名称匹配的组件都不会被缓存 ，其中 exclude 的优先级比 include 高；
3. 对应两个钩子函数 activated 和 deactivated ，当组件被激活时，触发钩子函数 activated，当组件被移除时，触发钩子函数 deactivated。