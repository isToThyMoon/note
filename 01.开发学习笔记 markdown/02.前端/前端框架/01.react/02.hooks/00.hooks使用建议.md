

**deps问题见 函数组件副作用和副作用依赖问题**

# useState 的正确使用姿势
useState 应该算最简单的一个 Hooks，但在使用中，也有很多技巧可循，如果严格按照以下几点，代码可维护性直接翻倍。

## 能用其他状态计算出来就不用单独声明状态
一个 state 必须不能通过其它 state/props 直接计算出来，否则就不用定义 state。
一般在项目中此类问题都比较隐晦，层层传递，在 Code Review 中很难一眼看出。如果能把变量定义清楚，那事情就成功了一半。

## 保证数据源唯一
在项目中同一个数据，保证只存储在一个地方。
不要既存在 redux 中，又在组件中定义了一个 state 存储。
不要既存在父级组件中，又在当前组件中定义了一个 state 存储。
不要既存在 url query 中，又在组件中定义了一个 state 存储。
在实际项目开发中，此类问题也是比较隐晦，编码时应注意。

## useState 适当合并
不要写太多太细的state 合并成对象
如果需要类似类组件中的this.setState默认合并，增量修改 看看ahook的useSetState

项目中有木有写过这样的代码：
```js
const [firstName, setFirstName] = useState();
const [lastName, setLastName] = useState();
const [school, setSchool] = useState();
const [age, setAge] = useState();
const [address, setAddress] = useState();

const [weather, setWeather] = useState();
const [room, setRoom] = useState();
```
反正我最开始是写过，useState 拆分过细，导致代码中一大片 useState。
```js
const [userInfo, setUserInfo] = useState({
  firstName,
  lastName,
  school,
  age,
  address
});

const [weather, setWeather] = useState();
const [room, setRoom] = useState();

```
当然这种方式我们在变更变量时，一定不要忘记带上老的字段，比如我们只想修改 firstName：
```js
setUserInfo(s=> ({
  ...s,
  fristName,
}))
```

其实如果是 React Class 组件，state 是会自动合并的：
```js
this.setState({
  firstName
})
```
在 Hooks 中，可以有这种用法吗？其实是可以的，我们自己封装一个 Hooks 就可以，比如 ahooks 的 useSetState，就封装了类似的逻辑：
```
const [userInfo, setUserInfo] = useSetState({
  firstName,
  lastName,
  school,
  age,
  address
});

// 使用时 自动合并
setUserInfo({
  firstName
})
```
使用了 useSetState 来代替 useState，来管理复杂类型的 state。