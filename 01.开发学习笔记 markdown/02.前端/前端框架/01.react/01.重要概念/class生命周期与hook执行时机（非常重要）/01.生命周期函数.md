---
title: 生命周期函数和axios
categories:
  - 01.开发学习笔记 markdown
  - 08.前端框架
  - 01.react
tags:
  - react项目
date:
---

生命周期函数 是指在某一时刻组件会自动调用执行的函数


三个钩子在react17删除
componentWillMount
componentWillReceiveProps
componentWillUpdate

由getDerivedStateFromProps取代

(1)componentWillMount在SSR中这个方法会被多次调用，会导致重复触发多次，同时若在这个方法内绑定事件将无法解绑，会造成内存泄露，这个方法变得不够安全高效而逐步被放弃。
(2)componentWillReceiveProps外部组件多次频繁更新传入多次不同的props，会导致不必要的异步请求。
(3)componentWillupdate,更新前记录DOM状态，可能会做一些处理，与componentDidUpdate相隔时间如果过长会导致状态不可信。


![截屏2021-03-12 下午12.37.36](https://raw.githubusercontent.com/ayrikiya/pic-store/main/note/%E6%88%AA%E5%B1%8F2021-03-12%20%E4%B8%8B%E5%8D%8812.37.36.png)

加上不常用周期：
![截屏2021-03-12 下午12.52.07](https://raw.githubusercontent.com/ayrikiya/pic-store/main/note/%E6%88%AA%E5%B1%8F2021-03-12%20%E4%B8%8B%E5%8D%8812.52.07.png)

具体可看官网介绍
![生命周期](https://tsejx.github.io/react-guidebook/static/react-lifecycle-methods-diagram.ae211f59.jpg)



## static getDerivedStateFromProps(nextProps, prevState)
一个特殊的static周期方法 取代旧api的一个修正方案。

一个静态方法，所以不能在这个函数里面使用this，这个函数有两个参数props和state，分别指接收到的新参数和当前的state对象，这个函数会返回一个对象用来更新当前的state对象，如果不需要更新可以返回null
在调用render()方法前调用。该函数会在挂载时，接收到新的props，调用了setState和forceUpdate时被调用

这个方法就是为了取代之前的componentWillMount、componentWillReceiveProps和componentWillUpdate

## [getSnapshotBeforeUpdate](https://zh-hans.react.dev/reference/react/Component#getsnapshotbeforeupdate)
getSnapshotBeforeUpdate取代了componentWillUpdate，触发时机为update发生的时候，在render之后、dom渲染dom改变之前，返回一个值，作为componentDidUpdate的第三个参数。
比如列表更新后新的数据不断插入到数据前面，如何保证可视区依旧是之前看到的呢？
```
getSnapshotBeforeUpdate(){
    return this.refs.wrapper.scrollHeight
}
    
componentDidUpdate(prevProps,prevState,preHeight){
    this.refs.wrapper.scrollTop+=this.refs.wrapper.scrollHeight-preHeight
}
.....
```
也就是说，在getSnapshotBeforeUpdate开始处于pre-commit阶段可以读取dom，但这里读的dom信息是未修改前的，在componentDidUpdate中可以使用dom，这里读到的dom是更新后的，但注意此时react并未让出js线程给渲染线程，所以屏幕此时还未变化，在componentDidUpdate中重新进行的state修改都不会发生页面闪烁。浏览器只能 paint 最后的 DOM 更变。

# 基础使用场景：

1.shouldcomponentUpdate解决重复渲染
我们知道， 当input输入框输入数据调用handleInputchange函数改变父组件state中inputValue的值 那么
父组件的render函数会重新执行 render里的子组件的也会重新渲染 子组件的render函数也会重新执行
这样子没输入一个值 父组件和子组件都重新渲染 带来性能损耗
怎么解决？
子组件生命周期函数
```JavaScript
shouldComponentUpdate(nextProps, nextState){
  if(nextProps.content !== this.props.content){
    return true;
  }else{
    return false;
  }
}
```

表示即将到来的渲染里 nextProps传来的content有没有变化？ 如果没有 则没有必要重新渲染

2.ajax请求位置
如果我想要在react中发送一个ajax请求 从远程服务器的api中请求一个list 把它渲染到页面上
在哪发ajax请求？
一般在生命周期函数的componentDidMount里发ajax请求  如果写在render里 会陷入重发渲染重复发请求的死循环
如果放在componentWillMount里 虽然没有问题 但是会和以后比较深的技术栈矛盾 引起不必要的问题 那么约定写在ComponentDidMount里

react内部便没有像jquery一样封装ajax请求
所以我们引入第三方库 yarn add axios 或者 npm install axios

```JavaScript
componentDidMount(){
			axios.get('/api/todolist')
			.then(() => {alert('succ')})
			.catch(() ={alert('error')})
}
```
