# Reactä¸­æ€§èƒ½ä¼˜åŒ–çš„æ‰‹æ®µ

æ¡†æ¶æœºåˆ¶å±‚é¢ï¼š
1. Keyæ ‡è®°ä¼˜åŒ–ä¸å¿…è¦çš„ç»„ä»¶æˆ–è€…domé‡ç»˜

2. React.memoä¸ shouldcomponentupdate å’ŒpureComponent

3. useMemo useCallbackæ¥ç¼“å­˜å€¼å’Œå‡½æ•° é¿å…é‡å¤è®¡ç®—
 
4. ç»„ä»¶çš„immutableä¸å¯å˜æ•°æ®ç»“æ„ ä¼˜åŒ–çŠ¶æ€æ›´æ–°æµç¨‹

å·¥ç¨‹æ‰“åŒ…å±‚é¢ï¼š

1. æ‡’åŠ è½½ç»„ä»¶
2. æœåŠ¡ç«¯æ¸²æŸ“SSR

ä»£ç å±‚é¢ï¼š
1. çŠ¶æ€æ‹†åˆ†åŸå­åŒ– é¿å…å¤æ‚æ ¼å¼æ•°æ®çš„æ›´æ–°
2. å±æ€§ä¼ é€’ä¼˜åŒ– ä¼ é€’å‚æ•°æ—¶å°½é‡å‡å°‘ä¼ é€’å‚æ•°çš„æ•°é‡
3. ä½¿ç”¨ React Fragments é¿å…é¢å¤–æ ‡è®°
4. ä¸è¦ä½¿ç”¨å†…è”å‡½æ•°å®šä¹‰ å¦‚onClickç»‘å®šä¸€ä¸ªåŒ¿åå‡½æ•°
5. å‡½æ•°ç»‘å®šthisé—®é¢˜ï¼Œåœ¨ Constructor çš„æ—©æœŸç»‘å®šå‡½æ•°this è€Œä¸æ˜¯renderï¼Œæ›´å¥½æ–¹æ³•æ˜¯ç®­å¤´å‡½æ•°
6. ä¼˜åŒ– React ä¸­çš„æ¡ä»¶æ¸²æŸ“
7. ä¸è¦åœ¨ render æ–¹æ³•ä¸­å¤§é‡åˆ›å»ºå¯¹è±¡å’Œå‡½æ•°
8. é¿å… componentWillMount() ä¸­çš„å¼‚æ­¥è¯·æ±‚
9. å¤šç»„ä»¶åˆ’åˆ†å±‚çº§ ä¼˜åŒ–
10. ä¸ºç»„ä»¶åˆ›å»ºé”™è¯¯è¾¹ç•Œ

ä¸šåŠ¡å±‚é¢ï¼š
1. è™šæ‹Ÿåˆ—è¡¨



# 1.åŠ Keyæ ‡è®°ä¼˜åŒ–ä¸å¿…è¦çš„ç»„ä»¶æˆ–è€…domé‡ç»˜

## ä¸ºä»€ä¹ˆåˆ—è¡¨è¦åŠ  key å±æ€§ï¼Œä»¥åŠä¸ºä»€ä¹ˆç”¨ index æ˜¯ä¸å¥½çš„

éå†å¯¹è±¡çš„æ¯ä¸€ä¸ªå±æ€§æ·±åº¦å¯¹æ¯”æ˜¯éå¸¸æµªè´¹æ€§èƒ½çš„

React ä½¿ç”¨åˆ—è¡¨çš„`key`æ¥è¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œå°±é»˜è®¤ä¸º index ä¸‹æ ‡

é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ ä¸æŒ‡å®š key/ç”¨ index ä¸‹æ ‡ æ˜¯ä¸å¥½çš„å‘¢ï¼Ÿ

å‡è®¾ç°åœ¨æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š

```
const users = [{ username: "bob" }, { username: "sue" }];

users.map((u, i) => <div key={i}>{u.username}</div>);

```

å®ƒä¼šæ¸²æŸ“å‡ºè¿™ä¸ª DOM æ ‘ï¼š

```
<div key="1">bob</div>
<div key="2">sue</div>

```

ç„¶åç”¨æˆ·åšäº†æŸä¸ªæ“ä½œï¼Œ`users` è¢« `unshift` å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå˜æˆï¼š

```
const users = [
  { username: "new-guy" },
  { username: "bob" },
  { username: "sue" },
];

```

DOM æ ‘å°±ä¼šå˜æˆè¿™æ ·ï¼Œæ³¨æ„`key`çš„å˜åŒ–ï¼š

```
<div key="1">new-guy</div>
<div key="2">bob</div>
<div key="3">sue</div>

```

DOM æ ‘çš„å‰åå¯¹æ¯”æ˜¯è¿™æ ·çš„ï¼š

```
<div key="1">bob</div>   |  <div key="1">new-guy</div>
<div key="2">sue</div>   |  <div key="2">bob</div>
                         |  <div key="3">sue</div>

```

æˆ‘ä»¬äººç±»çœ‹å¾—å‡ºæ¥å‰åçš„å˜åŒ–åªæ˜¯åœ¨å¼€å¤´åŠ äº†ä¸€ä¸ª`new-guy`è€Œå·²

ä½†æ˜¯ç”±äº React ä½¿ç”¨ key å€¼æ¥è¯†åˆ«å˜åŒ–ï¼Œæ‰€ä»¥ React è®¤ä¸ºçš„å˜åŒ–æ˜¯ï¼š

1. bob -> new-guy
2. sue -> bob
3. æ·»åŠ  sue

éå¸¸æ¶ˆè€—æ€§èƒ½ ğŸ˜­

ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸€å¼€å§‹å°±ç»™å®ƒæŒ‡å®šä¸€ä¸ªåˆé€‚çš„ keyï¼Œæ¯”å¦‚ç”¨ nameï¼š

```
users.map((u, i) => <div key={u.username}>{u.username}</div>);

```

React è®¤ä¸ºçš„å˜åŒ–å°±å˜æˆï¼š

```
	                         |  <div key="1">new-guy</div>
<div key="bob">bob</div>   |  <div key="bob">bob</div>
<div key="sue">sue</div>   |  <div key="sue">sue</div>

```

è¿™æ ·åªéœ€è¦åšä¸€ä¸ª`unshift`æ“ä½œï¼Œæ€§èƒ½èŠ‚çœ ğŸ˜ƒ


# 

dynamic import / lazy å®˜æ–¹ä»£ç å±‚æ”¯æŒã€‚
è¿›è¡Œä»£ç åˆ†å‰²ï¼Œæš‚æ—¶ä¸éœ€è¦åŠ è½½çš„ä»£ç ç›´æ¥æ²¡æœ‰è¯·æ±‚èµ„æºã€‚


React.memo
reacté»˜è®¤è¡Œä¸ºï¼Œçˆ¶ç»„ä»¶çŠ¶æ€æ›´æ–°ï¼Œè‡ªç»„ä»¶è™½ç„¶æ²¡æœ‰ç”¨åˆ°è¿™ä¸ªçŠ¶æ€ï¼Œä¹Ÿä¼šè¢«é‡æ–°åˆ·æ–°ã€‚
å¦‚æœè‡ªç»„ä»¶è¿›è¡Œäº†å¤§é‡è€—æ—¶è€—cpuè®¡ç®—æ“ä½œï¼Œè¿™æ ·æ˜¯æ¯”è¾ƒè€—è´¹æ€§èƒ½çš„ã€‚
react.memoç±»ä¼¼ä¹‹å‰çš„pureComponent
åªæœ‰åœ¨è‡ªç»„ä»¶çš„propsæ”¹å˜æˆ–è€…å†…éƒ¨çŠ¶æ€ä¿®æ”¹æ—¶æ‰ä¼šé‡æ–°æ¸²æŸ“ã€‚

ä¸€èˆ¬æƒ…å†µå¾ˆå°‘ä½¿ç”¨ï¼Œreact.memoæœ¬èº«è€—è´¹ä¸€å®šæ€§èƒ½ï¼Œä¸”reactæœ¬èº«è¶³å¤Ÿå¿«é€Ÿï¼Œéœ€è¦ä½¿ç”¨å®ƒçš„åœºæ™¯å¾ˆå°‘è§ã€‚



profiler apiè¿›è¡Œæ€§èƒ½è¿½è¸ªã€‚


# 2.React.memoä¸ shouldcomponentupdate å’ŒpureComponent



# ç®€åŒ–çš„render prop å®ç°å‡å°‘å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ¸²æŸ“
å…ˆæ¥çœ‹ä¸€æ®µå¸¸è§çš„ React ä»£ç 
```jsx
import { useState } from "react"

const Father = () => {
  const [count, setCount] = useState(0);
  console.log("Father rendered");
  return (
    <>
      <p>I am Father p tag, {count}</p>
      <button onClick={() => setCount(count + 1)}>Add Count</button>
      <br />
      <Children />
    </>
  );
};

const Children = () => {
  console.log("Children rendered");
  return <p>I am Children p tag</p>;
};
```
æ¯æ¬¡ç‚¹å‡»è§¦å‘Fatherç»„ä»¶çš„é‡æ¸²æŸ“ï¼Œæ ¹æ®reactæ¯”è¾ƒå¼å“åº”çš„åŸåˆ™ï¼Œå­ç»„ä»¶Childrenä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚
å®é™…ä¸Šåœ¨å­ç»„ä»¶ä¸­ï¼Œå¹¶æ²¡æœ‰ç”¨åˆ°æ¥è‡ªçˆ¶ç»„ä»¶çš„çŠ¶æ€æˆ–æ˜¯è‡ªèº«çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œæ—¢ç„¶çŠ¶æ€å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ä¸å­˜åœ¨é‡æ–°æ¸²æŸ“çš„éœ€è¦ï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ä»¶æ›´æ–°å°±æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚å¦‚æœå­ç»„ä»¶çš„æ¸²æŸ“å¼€é”€æ¯”è¾ƒå¤§ï¼Œè¿™å¯èƒ½ä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚

é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå¯èƒ½ç¬¬ä¸€ååº”æ˜¯ç»™å­ç»„ä»¶åŠ ä¸ŠPureComponentæˆ–è€… React.memo è¿›è¡Œ props æµ…å±‚æ¯”è¾ƒï¼Œæˆ–è€…shouldComponentUpdateæ§åˆ¶æ˜¯å¦é‡æ¸²æŸ“ã€‚

æˆ‘ä»¬ä»å…¶ä»–è§’åº¦å¯»æ‰¾å…¶ä»–è§£å†³æ–¹å¼ã€‚

æ”¹åŠ¨ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼Œåœ¨çˆ¶ç»„ä»¶å’Œå­ç»„ä»¶ä¹‹é—´æ·»åŠ ä¸€ä¸ªæ‰¿è½½é€»è¾‘çš„ç»„ä»¶ï¼ˆFatherLogicï¼‰ï¼š

```js
import { useState } from "react";

const Father = () => {
  console.log("Father rendered");
  return (
    <FatherLogic>
      <br />
      <Children />
    </FatherLogic>
  );
};

const FatherLogic = ({ children }) => {
  const [count, setCount] = useState(0);
  console.log("FatherLogic rendered");
  return (
    <>
      <p>I am Father p tag, {count}</p>
      <button onClick={() => setCount(count + 1)}>Add Count</button>
      {children}
    </>
  );
};

const Children = () => {
  console.log("Children rendered");
  return <p>I am Children p tag</p>;
};
```

åœ¨è¿™ä¸ª é€»è¾‘ ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬æŠŠåŸå…ˆçˆ¶ç»„ä»¶ä¸­ä¾èµ– state çš„éƒ¨åˆ†æ”¾åœ¨äº†è¿™é‡Œï¼Œå°†çŠ¶æ€è¿›è¡Œä¸‹æ”¾ï¼Œå…¶ä½™ä¸ä¾èµ–çš„éƒ¨åˆ†åˆ™é€šè¿‡ç»„ä»¶çš„ children å±æ€§ä¼ é€’ç»™ é€»è¾‘ç»„ä»¶ã€‚

ä¸ºä»€ä¹ˆè¿™æ ·å»ºç«‹ä¸€ä¸ªä¸­é—´å®¹å™¨ï¼Œå°±ä¸ä¼šé‡å¤è§¦å‘Childrenç»„ä»¶æ¸²æŸ“ï¼Ÿ

éå¸¸ç®€å•ï¼Œåœ¨Fatherç»„ä»¶ä¸­ï¼ŒChildrenä½œä¸ºpropsè¢«ä¼ å…¥FatherIocä¸­ï¼ŒFatherIocç»„ä»¶çš„é‡æ¸²æŸ“ä¸ä¼šä¿®æ”¹ä¼ å…¥çš„propsã€‚

è¿™é‡Œå…¶å®ä¸æ˜¯æ‰€è°“æ ‡å‡†çš„render propï¼Œæ ‡å‡†çš„render propæ˜¯çˆ¶ç»„ä»¶çš„propå±æ€§ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªåŒ…å«å¤ç”¨é€»è¾‘çš„ç»„ä»¶ï¼Œè¿™ä¸ªè¢«ä¼ å…¥çš„renderå‡½æ•°åœ¨çˆ¶ç»„ä»¶å†…éƒ¨è¢«è°ƒç”¨ï¼Œå¯ä»¥æ¥å—çˆ¶ç»„ä»¶çš„stateä¸ºå…¥å‚ï¼Œå¤„ç†åçš„å¤ç”¨é€»è¾‘ç»„ä»¶å°†åœ¨çˆ¶ç»„ä»¶å†…éƒ¨ä½¿ç”¨ã€‚ä½†å®ç°äº†é€»è¾‘çš„å¤ç”¨ã€‚

è€Œè¿™é‡Œä¼˜åŒ–é‡æ¸²æŸ“çš„ä¾‹å­ä¸­ï¼Œç»„ä»¶Childrenä¸Fatherç»„ä»¶çš„çŠ¶æ€å˜æ›´æ— å…³ï¼Œå°†Childrenç»„ä»¶æ‹‰åˆ°Fatherçš„ç»„ä»¶çˆ¶çº§ï¼Œä½œä¸ºpropä¼ å…¥å¹¶åœ¨jsxä¸­ä½¿ç”¨ï¼Œè¿™æ ·Fatheré€»è¾‘ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶å°±ä¸ä¼šå½±å“åˆ°ä½œä¸ºpropsä¼ å…¥çš„Childrenç»„ä»¶ã€‚

æœ‰äº›è®¤çŸ¥è®¤ä¸ºFatherLogicä¹Ÿå¯ä»¥çœ‹æˆæ˜¯FatherIoCï¼Œæ•´ä½“å½“æˆæ˜¯ä¸€ç§ä¾èµ–å€’ç½®çš„å…·ä½“å®ç°ï¼Œä¾èµ–æ³¨å…¥ã€‚Childrenä½œä¸ºä½å±‚æ¨¡å—å¯ä»¥è¢«éšæ„æ›¿æ¢ï¼Œé«˜å±‚æ¨¡å—Fatherä½¿ç”¨ä½å±‚æ¨¡å—è€Œä¸ä¾èµ–å®ƒï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡FatherIoCèƒ¶åˆã€‚åªèƒ½è¯´æ•´ä½“æ¨¡å¼æœ‰ç‚¹åƒï¼Œä½†å¹¶ä¸æ˜¯å®Œå…¨çš„ä¾èµ–å€’ç½®ï¼Œåªèƒ½è¯´ç±»ä¼¼ã€‚

æ›´æ¥è¿‘Render Propæ¨¡å¼è€Œä¸æ˜¯ä¾èµ–æ³¨å…¥ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä½¿ç”¨äº†ç±»ä¼¼Render Propçš„æ¨¡å¼ï¼Œé€šè¿‡FatherLogicç»„ä»¶çš„children propæ¥ä¼ é€’å­ç»„ä»¶ï¼Œå…è®¸çˆ¶ç»„ä»¶å†³å®šæ¸²æŸ“ä»€ä¹ˆå†…å®¹ã€‚

è¿™ç§æ¨¡å¼ä¸Render Propæ¨¡å¼éå¸¸ç›¸ä¼¼ï¼Œå°½ç®¡åœ¨ä¼ é€’å­ç»„ä»¶æ—¶æ²¡æœ‰ä½¿ç”¨æ˜¾å¼çš„å‡½æ•°ï¼Œä½†å®ƒå…±äº«äº†Render Propæ¨¡å¼çš„ä¸€äº›æ€æƒ³ï¼Œå³é€šè¿‡Propsä¼ é€’ç»„ä»¶ä»¥å®ç°æ¸²æŸ“å’Œæ•°æ®ä¼ é€’çš„çµæ´»æ€§ã€‚