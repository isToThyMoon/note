---
title: 05.组件数据通信
categories:
  - 01.开发学习笔记 markdown
  - 08.前端框架
  - 01.react
tags:
  - react项目
date:
---

组件拆分自然而然就要考虑组件间的数据通信问题。

# 父子组件通信 

## 父传子：
通过props  属性 来传递数据


## 子传父：
### 回调函数
利用回调函数：父组件使用props属性向子组件传递一个函数，子组件携带自己的数据并通过调用该函数向父组件传递数据

## 父组件调用子组件方法
ref获取整个子组件对象，可以调用子组件中的函数
```html
<div>
  <button onClick={() => {
      this.refs.mychild.handleEvent("父组件传来的");
  }}>子组件</button>
  <Child ref='mychild' />
</div>
```

# 爷孙、跨级、非嵌套组件间通信
1. 层层组件传递props 例如：A组件和B组件之间要通信，A先向C组件通信，C组件通过props和B组件通信，3层组件还能接受，再多层级的props传递代码就非常累赘不直观了。
2. 使用context：生产/消费者模式 context的问题也很多，具体可见状态管理相关内容。主要是数据流向不清晰，容易引起传递值混乱，context的实现也容易造成大量全app层级的rerender高开销。一般只用于app主题等全局配置的数据。
3. 其他的全局状态管理方案redux mobx jotai等等。
4. 自定义的事件机制，发布/订阅模式，通过向事件对象上添加监听器和触发器来实现组件间的通信，本质和context实现是差不多原理，context加上了数据修改后的租组件rerender。通过events、mitt等发布订阅库来实现。缺点是会增加子组件和父组件之间的耦合度，如果嵌套深的话，不易找到父组件。
