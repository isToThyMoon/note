---
title: 13
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
---

正常想法从app.py拆分视图函数是
不同文件建立不同蓝图 分别管理 多次注册到总的flask核心对象上

这样不太理想

blueprint 是用来给我们在大型项目里拆分不同模块的 不是拆文件的

比如api web cms内容管理 这样级别的才可以当做一个蓝图去管理

仅仅是一个url就拆分一个蓝图不是不可以 但是小题大做 层级不清晰

我们使用单蓝图多模块拆分视图函数

一个蓝图作为管理一个大的层级比如web应用 api应用的url管理 把它放在 大的层级 比如web文件夹下的init文件内 




web文件夹下 __init__.py

``` python

from flask import Blueprint


web = Blueprint('web', __name__)

# book 和user的视图函数在单独的文件里 并没有被执行， 必须导入一次 否则还是404
from app.web import book
from app.web import user

```



web文件夹下 book.py

``` python

from flask import jsonify
# 创建的蓝图已经移动到init.py里 找不到了 所以需要导入一次
from . import web
from helper import is_isbn_or_key
from yushu_book import YuShuBook


@web.route('/book/search/<q>/<page>')
def search(q, page):
    """
        q: 普通关键字  isbn
        page:
    """

    isbn_or_key = is_isbn_or_key(q)
    if isbn_or_key == 'isbn':
        result = YuShuBook.search_by_isbn(q)
    else:
        result = YuShuBook.search_by_keyword(q)
        print(result)
    # result是一个dict  序列化为json字符串返回
    return jsonify(result)
    # return json, dumps(result), 200, {'content-type':'application/json'}


```


好像出现了循环引用  但是 python 中  模块的引入只会执行一次
所以其实__init__.py下的
from app.web import book
from app.web import user
只执行了一次


为什么呢：
python代码的import逻辑是：
在处理一个文件时，首先正常执行代码，当遇到导入命令时，进入到导入模块执行模块内的代码，执行完毕后回到主文件继续执行主文件剩下的代码，需要注意的是，模块的引入只会被执行一次。