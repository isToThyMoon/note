---
title: 13
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
---

之前的查询
gifts = Gift.query.filter_by(uid=uid, launched=False).order_by(
           desc(Gift.create_time)).all()
是指定查询表的

但db.session查询是没有指定的 需要我们指定查询主体
db.session.query(Wish).filter()

filter_by接受一些关键字参数
filter接受条件表达式

``` python

@classmethod
    def get_wish_counts(cls, isbn_list):
        # 根据传入的一组ISBN，到wish表 计算出某个礼物的wish心愿数量
        # db.session返回的内容由query后面的参数限制 这里是一个包含多个tuple:(count， isbn)的list  我们不直接返回元组 应该统一返回dict
        # 我们也可以用collections模块下的 namedtuple快速建立对象 但还是先用dict
        count_list = db.session.query(func.count(Wish.id), Wish.isbn).filter(
                                      Wish.launched == False,
                                      Wish.isbn.in_(isbn_list),
                                      Wish.status == 1).group_by(
                                      Wish.isbn).all()
        # 包含tuple的list 转化成一个dict
        count_list = [{'count': w[0], 'isbn': w[1]} for w in count_list]
        return count_list


```
