---
title: 13
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
---

``` python

# 暂时最简单的

@web.route('/book/search/<q>/<page>')
def search(q, page):
 pass

# 加了尖括号 q 和page就被识别成一个参数 而不是固定的url字符串




更优雅的视图函数传参

利用flask内置的Request （http请求信息 查询参数 post参数 remote ip）
和Response对象
实现

@web.route('/book/search')
def search():
    """
        q: 普通关键字  isbn
        page:
    """
    q = request.args['q']
    page = request.args['page']
    isbn_or_key = is_isbn_or_key(q)
    if isbn_or_key == 'isbn':
        result = YuShuBook.search_by_isbn(q)
    else:
        result = YuShuBook.search_by_keyword(q)
        print(result)
    # result是一个dict  序列化为json字符串返回
    return jsonify(result)
    # return json, dumps(result), 200, {'content-type':'application/json'}


# 这里的request.args 不是一个不同dict 而是一个immutable dict  不可变对象
# 想要操作它 可以调用 a = request.args.to_dict()











"""
在python中发送http请求：
1 使用python自带的urllib
    from urllib import request
2 第三方库 requests
"""

import requests

class HTTP:
    def get(self, url, return_json=True):
        r = requests.get(url)
        return r.json()
# 这里的r得到的是requests对get请求得到的返回结果的一个封装 类 并不是想要的直接结果 调用此类的方法得到想要的结果
# r.content 是字节流   r.content.decode('utf-8')得到解码后的str字符串

import requests


class HTTP:
    @staticmethod
    def get(url, return_json=True):
        r = requests.get(url)
        # restful json
        # 三元表达式简化代码
        if r.status_code != 200:
            return {} if return_json else ''
        return r.json() if return_json else r.text

        # if r.status_code == 200:
        #     if return_json:
        #         return r.json()
        #     else:
        #         return r.text
        # else:
        #     if return_json:
        #         return {}
        #     else:
        #         return ''

# return的r.json() 将r的内容序列化为json格式字符串  python中如果以一个变量接受这个返回值 变量指向的就是一个dict
# 也就是说 python print(r.json())出来的是一个dict

```


