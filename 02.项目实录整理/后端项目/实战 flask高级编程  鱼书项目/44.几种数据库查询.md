---
title: 44.几种数据库查询
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
tags:
  - 后端
date:
---

```python

from app.models.wish import Wish
    # 根据传入的一组ISBN，到wish表 计算出某个礼物的wish心愿数量
    # db.session返回的内容由query后面的参数限制 这里是一个包含多个tuple:(count， isbn)的list  我们不直接返回元组 应该统一返回dict
    # 我们也可以用collection模块下的 namedtuple快速建立对象
    count_list = db.session.query(func.count(Wish.id), Wish.isbn).filter(
                                  Wish.launched == False,
                                  Wish.isbn.in_(isbn_list),
                                  Wish.status == 1).group_by(
                                  Wish.isbn).all()



# 到Gift 表中检索出相应的礼物
gifts = Gift.query.filter_by(uid=uid, launched=False).order_by(
        desc(Gift.create_time)).all()


drifts = Drift.query.filter(
                                or_(Drift.request_id == current_user.id,Drift.gifter_id == current_user.id)).order_by(
                                   desc(Drift.create_time)).all()


```


------------------------------------------------------
两种写法 一样效果

``` python

gift = Gift.query.filter_by(id=drift.gift_id).first_or_404()
        gift.launched =True

Wish.query.filter_by(isbn=drift.isbn, uid = drift.requester_id,
                     launched = False).update({Wish.launched: True})

```

----------------------------------------------------------------
