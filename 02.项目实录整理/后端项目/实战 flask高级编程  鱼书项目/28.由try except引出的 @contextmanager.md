---
title: 28.由try except引出的 @contextmanager
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
tags:
  - 后端
date:
---

对事务和回滚 每次都要写这样的重复try except代码 有没有可能简化

首先回顾上下文管理器

```python

class MyResource(self):
      def __enter__(self):
        print('connect to resource')
            return self

      def __exit__(self, exc_type, exc_value, tb):
          print('close resource connection')

      def query(self):
          print('query data')

with MyResource() as r:
    r.query()

```

有没有办法简化enter和exit的定义？

------------------

```python

from contextlib import contextmanager

class MyResource:
      def query(self):
          print('query data')

@contextmanager
def make_myresource():
    print('connect to resource')
    yield MyResource()
    print('close resource connection')

# yield 生成器
with make_myresource() as r:
    r.query


@contextmanager 其实并没有简化enter exit的定义 但它有一个很大的好处

@contextmanager
def book_mark():
    print('《', end='')
    yield
    print('》', end='')

with book_mark():
    print('美的历程', end='')

```


给了我们一个机会 把不是上下文管理器的类 包装变成一个上下文管理器
