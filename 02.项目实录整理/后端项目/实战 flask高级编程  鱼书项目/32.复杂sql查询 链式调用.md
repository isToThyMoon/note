---
title: 13
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
---

``` python

from flask import current_app

from app.models.base import db, Base
from sqlalchemy import Column, Integer, String, Boolean, ForeignKey
from sqlalchemy.orm import relationship


class Gift(Base):
    id = Column(Integer, primary_key=True)
    isbn = Column(String(15), nullable=False, unique=True)
    user = relationship('User')
    uid = Column(Integer, ForeignKey('user.id'))
    launched = Column(Boolean, default=False)

    # book = relationship('Book')
    # bid = Column(Integer, ForeignKey('book.id'))


    def recent(self):
        # 链式调用
        # 主体Query
        # 子函数
        # 触发条件
        recent_gift = Gift.query.filter_by(launched=False).group_by(
            Gift.isbn).order_by(
            Gift.create_time).limit(
            current_app.config['RECENT_BOOK_COUNT']).distinct().all()
        return recent_gift

```



这种查询的写法叫做链式调用
这种调用都有一个主体 这里是Query
一些子函数 这些子函数返回的也是Query
触发语句 all()  first()  有了触发才真正执行数据库的查询
