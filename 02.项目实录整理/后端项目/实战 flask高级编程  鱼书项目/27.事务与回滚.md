---
title: 13
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
---

事务是数据库里的一个概念

放在模型里也适用

一个视图操作了两张表 如果发生异常 那么数据就会发生混乱 必须保证这两个表操作要么一起执行要么都不执行

用事务保持数据的一致性

用sqlalchemy作一个事务的操作

``` python

try:
    gift = Gift()
    gift.isbn = isbn
    gift.uid= current_user.id
    current_user.beans += current_app.config['BEANS_UPLOAD_ONE_BOOK']
    db.session.add(gift)
    db.session.commit()
except Exception as e:
    db.session.rollback()
    raise e


```

