---
title: 13
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
---

``` python

什么是用户登陆： 验证身份
验证通过 返回set-cookie：
下一次浏览器带上cookie字段 表示身份

setcookie就像颁发票据 可以设置在一定时间内 每次访问网站可带上这个票据 无需再登陆
这就是服务器登陆过期时间设置 有效期

@web.route('/set/cookie')
def set_cookie():
    response = make_response('hello dadada')
    response.set_cookie('name', 'dadada', 100)


自己实现非常繁琐
利用第三方插件 flask-login 管理cookie

初始化：
from flask import Flask
from app.models.base import db
from flask_login import LoginManager

login_manager = LoginManager()

def create_app():
    app = Flask(__name__)
    app.config.from_object('app.secure')
    app.config.from_object('app.setting')
    register_blueprint(app)

    db.init_app(app)
    login_manager.init_app(app)
    # init 方法没有保存核心对象 只作临时参数 所以create_all()方法还要传入核心对象
    db.create_all(app=app)
    # 或者 让create_all 自己寻找current_app 传入
    # with app.app_context():
    #   db.create_all()
    # 或者 一开始实例化db = SQLAlchemy() 时 把app 作为属性 参数传入
    return app


def register_blueprint(app):
    from app.web import web
    app.register_blueprint(web)




使用cookie
@web.route('/login', methods=['GET', 'POST'])
def login():
    form = LoginForm(request.form)
    if request.method == 'POST' and form.validate():
        user= User.query.filter_by(email=form.email.data).first()
        if user and user.check_password(form.password.data):
            login_user(user)

        else:
            flash('账号不存在或密码错误')
    return render_template('auth/login.html', form=form)


login_user()这个函数实现把我们自定义模型的数据存入cookie 但是不可能存入所有信息 只存最主要的id
所以为了识别id   login_user(user)这个函数要求我们定义的user模型实现一个get_id方法
flask_login定义的UserMixin类实现了这些属性 通过让User继承UserMixin 可以不费力解决这个问题


login_user(user, remember=True)
remember=True  表示免登陆  时间默认365天   可通过配置文件增加 REMEMBER_COOKIE_DURATION值来自定义


```


