---
title: 13
categories:
  - 项目实录整理
  - 后端项目
  - 实战 flask高级编程  鱼书项目
---

保存到数据库的代码应该写在最靠近结果的地方？spider 的yushu_book

留待以后写


再说视图函数
视图函数两种查询返回的格式内容应该统一  不造成混乱
补充返回页面view层需要的其他数据


viewmodel
从api或者数据库得到的数据是原始数据 而页面需要的数据可能是对原始数据的修改

那么在model和view之间 有viewmodel 裁剪 修饰 合并 原始数据

``` python

class BookViewModel:
    @classmethod
    def package_single(cls, data, keyword):
        returned = {
            'books': [],
            'total': 0,
            'keyword': keyword
        }
        if data:
            returned['total'] = 1
            returned['books'] = [cls.__cut_book_data(data)]
        return returned

    @classmethod
    def package_collection(cls, data, keyword):
        returned = {
            'books': [],
            'total': 0,
            'keyword': keyword
        }
        if data:
            returned['total'] =data['total']
            returned['books'] = [cls.__cut_book_data(book) for book in data['books'] ]
        return returned

    @classmethod
    def __cut_book_data(cls, data):
        book = {
            'title': data['title'],
            'publisher': data['publisher'],
            'pages': data['pages'] or '',
            'author': '、'.join(data['author']),
            'price': data['price'],
            'summary': data['summary'] or '',
            'image': data['image']
        }
        return book

```


然后在视图函数中得到api请求信息后调用类方法处理修建请求信息 就完成这样的业务逻辑
