---
title: 13
categories:
  - 项目实录整理
  - 前端项目
  - 04.实战 react 共享单车项目（lese）
---

webpack配置暴露less 使用less
因为antD是基于less开发的  虽然可以导入antD.css直接使用  但是今后的换肤功能还是要使用less方便
1.所以暴露webpack配置
npm run eject


2.使用babel-plugin-import 来按需加载组件代码和样式（antd）：
npm install babel-plugin-import --save-dev

3.通过 .babelrc 配置文件或者 babel-loader 模块编程引入。也可以在package.json中配置

```
"babel": {
        "presets": [
            "react-app"
        ],
        "plugins": [["import", { "libraryName": "antd", "libraryDirectory": "es", "style": true } ]]
},
```

这样配合下面的less支持
就可以只写
import { Button } from 'antd';
不用手动引入antd.css 或者全局引入antd的样式文件。
babel-plugin-import 会按需加载所要的组件入Button  自动引入less



# 支持less：
npm install less less-loader --save-dev 
目前来看 很奇怪 只有less 3.0.0 和 less-loader 5.0.0有效
less-loader 的版本过高，会不兼容 getOptions 函数方法 此方法在antd中有使用
less-loader版本降级 less也要版本配套


修改webpack.config.js

```
const cssRegex = /\.css$/;
const cssModuleRegex = /\.module\.css$/;
const sassRegex = /\.(scss|sass)$/;
const sassModuleRegex = /\.module\.(scss|sass)$/;

const lessRegex = /\.less$/;
const lessModuleRegex = /\.module\.less$/;
```

oneOf[]下

```
oneOf[
{
   test: cssRegex,
   exclude: cssModuleRegex,
   use: getStyleLoaders({
     importLoaders: 1,
     sourceMap: isEnvProduction && shouldUseSourceMap,
   }),
   // Don't consider CSS imports dead code even if the
   // containing package claims to have no side effects.
   // Remove this when webpack adds a warning or an error for this.
   // See https://github.com/webpack/webpack/issues/6571
   sideEffects: true,
  },
  // Adds support for CSS Modules (https://github.com/css-modules/css-modules)
  // using the extension .module.css
  {
   test: cssModuleRegex,
   use: getStyleLoaders({
     importLoaders: 1,
     sourceMap: isEnvProduction && shouldUseSourceMap,
     modules: true,
     getLocalIdent: getCSSModuleLocalIdent,
   }),
  },
  // Opt-in support for SASS (using .scss or .sass extensions).
  // By default we support SASS Modules with the
  // extensions .module.scss or .module.sass
  {
   test: sassRegex,
   exclude: sassModuleRegex,
   use: getStyleLoaders(
     {
       importLoaders: 2,
       sourceMap: isEnvProduction && shouldUseSourceMap,
     },
     'sass-loader'
   ),
   // Don't consider CSS imports dead code even if the
   // containing package claims to have no side effects.
   // Remove this when webpack adds a warning or an error for this.
   // See https://github.com/webpack/webpack/issues/6571
   sideEffects: true,
  },
  // Adds support for CSS Modules, but using SASS
  // using the extension .module.scss or .module.sass
  {
   test: sassModuleRegex,
   use: getStyleLoaders(
     {
       importLoaders: 2,
       sourceMap: isEnvProduction && shouldUseSourceMap,
       modules: true,
       getLocalIdent: getCSSModuleLocalIdent,
     },
     'sass-loader'
   ),
  },

  {
   test: lessRegex,
   exclude: lessModuleRegex,
   use: getStyleLoaders(
     {
       importLoaders: 3,
       sourceMap: isEnvProduction && shouldUseSourceMap,
     },
     'less-loader'
   ),
   // Don't consider CSS imports dead code even if the
   // containing package claims to have no side effects.
   // Remove this when webpack adds a warning or an error for this.
   // See https://github.com/webpack/webpack/issues/6571
   sideEffects: true,
  },
  // Adds support for CSS Modules, but using SASS
  // using the extension .module.scss or .module.sass
  {
   test: lessModuleRegex,
   use: getStyleLoaders(
     {
       importLoaders: 3,
       sourceMap: isEnvProduction && shouldUseSourceMap,
       modules: true,
       getLocalIdent: getCSSModuleLocalIdent,
     },
     'less-loader'
   ),
  },
]

```