---
title: 13.表格 axios封装 统一loading页
categories:
  - 项目实录整理
  - 前端项目
  - 04.实战 react 共享单车项目（lese）
tags:
  - react
date:
---

### 基础表格

```javascript

class BassicTable extends Component {
	
	state={}

	componentDidMount(){
		const dataSource = [
			{
				id: '0',
				userName: 'dadada',
				sex: '1',
				state: '1',
				interest: '1',
				birthday: '1999-01-01',
				address: '北京市哒哒哒区',
				time: '08:00'
			},
			{
				id: '1',
				userName: 'dididi',
				sex: '1',
				state: '1',
				interest: '1',
				birthday: '1999-01-01',
				address: '北京市哒哒哒区',
				time: '08:00'
			},
			{
				id: '2',
				userName: 'dododo',
				sex: '1',
				state: '1',
				interest: '1',
				birthday: '1999-01-01',
				address: '北京市哒哒哒区',
				time: '08:00'
			}
		];

		this.setState({
			dataSource
		})

	};


	render() {
		const columns = [
			{
				title: 'id',
				dataIndex: 'id'
			},
			{
				title: '用户名',
				dataIndex: 'userName'
			},
			{
				title: '性别',
				dataIndex: 'sex',
				render(sex){
					return sex ===1 ? '男' : '女'
				}
			},
			{
				title: '状态',
				dataIndex: 'state',
				render(state){
					let config = {
						'1': '单身',
						'2': '已婚'
					}
					return config[state];
				}
			},
			{
				title: '爱好',
				dataIndex: 'interest'
			},
			{
				title: '生日',
				dataIndex: 'birthday'
			},
			{
				title: '地址',
				dataIndex: 'address'
			},
			{
				title: '时间',
				dataIndex: 'time'
			}
		];

		return (
			<div>
				<Card title="基础表格">
					<Table 
						columns={columns}
						dataSource={this.state.dataSource}
					/>
				</Card>
			</div>
		)
	};
};

export default BassicTable;

```

-------

### 项目的架构和工程化：
工程化 对公共机制的封装 标准的封装(其实就是把经常使用的代码 方法按功能集中到一个库):

1.axios封装 
2.Loading处理 错误拦截

Table动态渲染：

```javascript
<Card title="mock动态渲染数据表格">
	<Table 
		columns={columns}
		dataSource={this.state.dataSource2}
	/>
</Card>
```

```javascript
request = () => {
		let baseUrl = 'https://www.easy-mock.com/mock/5c9e1f2d51af0e3f5b728cf8/dancheapi'
		axios.get(baseUrl + "/table/list").then(
			(res)=>{
				if(res.status === 200 && res.data.code === 0){
					this.setState({
						dataSource2: res.data.result
					})
				}
			})
	}
```

-------
优化动态渲染的请求数据逻辑 封装axios：
axios已经是一个Promise对象 用另一个promise对象包裹 操作axios获得的结果

```javascript
static ajax(options){
      let baseApi ='https://www.easy-mock.com/mock/5c9e1f2d51af0e3f5b728cf8/dancheapi';
		return new Promise((resolve, reject)=>{
			axios({
				url: options.url,
				method: 'get',
				baseURL: baseApi,
				timeout: 5000,
				params: (options.data && options.data.params) || ''
			})
			.then((response)=>{
				if (response.status === 200){
					let res = response.data;
					if (res.code == 0){
						resolve(res);
					}else{
						Modal.info({
							title: '提示',
							content: res.msg
						})
					}
				}else{
					reject(response.data);
				}
			})
		})
	}
```

-------

统一Loading页 错误拦截 拦截器
在自定义公共组件 Axios中

```javascript
static ajax(options){
	let loading;
	if (options.data && options.data.isShowLoading !== false){
		loading = document.querySelector('#ajaxLoading');
		loading.style.display ='block';
	}

	let baseApi ='https://www.easy-mock.com/mock/5c9e1f2d51af0e3f5b728cf8/dancheapi';
	return new Promise((resolve, reject)=>{
		axios({
			url: options.url,
			method: 'get',
			baseURL: baseApi,
			timeout: 5000,
			params: (options.data && options.data.params) || ''
		})
		.then((response)=>{
			if (options.data && options.data.isShowLoading !== false){
				loading =document.querySelector('#ajaxLoading');
				loading.style.display ='none';
			}
			if (response.status === 200){
				let res = response.data;
				if (res.code === 0){
					resolve(res);
				}else{
					Modal.info({
						title: '提示',
						content: res.msg
					})
				}
			}else{
				reject(response.data);
			}
		})
	})
}
```
